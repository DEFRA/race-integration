@page "/annual-statements"
@using Microsoft.AspNetCore.Authorization
@using RACE2.FrontEndWebServer.Components
@using RACE2.Dto;
@using RACE2.DataModel;

@attribute [Authorize]

<HeaderWithBanner />

<div class="govuk-width-container" style="min-height: 69vh;">

    <FeedbackBannerSignOut />

    <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">

        <div class="govuk-grid-row">

            <div class="govuk-grid-column-full">

                <h1 class="govuk-heading-xl">
                    Your annual statements
                </h1>

                @*                 <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                <div class="govuk-grid-row">
                <div class="govuk-grid-column-two-thirds">

                <EditForm Model="@ReservoirsLinkedToUserForDisplay" method="get" novalidate="">

                <div class="search-wrapper govuk-form-group">
                <label for="search-applications" class="govuk-label">Search by reservoir name</label>

                <div class="search-input-wrapper">
                <InputText @bind-Value="@_searchString" id="search-applications" name="search" style="height:50px;" title="Search" class="govuk-input"
                @onkeydown="@SearchOnEnter"/>

                <div class="search-input-submit-wrapper">
                <button type="button" class="search-submit" @onclick=@(args => FilterData(@_searchString))>Search</button>
                </div>
                </div>
                </div>

                </EditForm>
                </div>
                </div>
                </div>
                </div> *@
                <h5 class="govuk-table__caption govuk-table__caption--m">Templates</h5>
                <table class="govuk-table govuk-!-margin-top-4">
@*                     <caption class="govuk-table__caption govuk-table__caption--m">Templates</caption>
 *@                    <thead class="govuk-table__head" style="width:100%;">
                        <tr class="govuk-table__row govuk-body govuk-!-font-size-16">
                            <th scope="col" class="govuk-table__header app-custom-class" width="25%">
                                <button aria-label="Sort by Reservoir" type="button" class="icon-sort-button"
                                        onclick="@(() => SortTable("ReservoirName"))">
                                    Reservoir
                                    <div class="icon-sort"></div>
                                </button>
                            </th>
                            <th scope="col" class="govuk-table__header app-custom-class" width="25%">
                                <button aria-label="Sort by Undertaker" type="button" class="icon-sort-button"
                                        onclick="@(() => SortTable("UndertakerName"))">
                                    Undertaker
                                    <div class="icon-sort"></div>
                                </button>
                            </th>
                            <th scope="col" class="govuk-table__header app-custom-class" width="20%">
                                <button aria-label="Sort by Due date" type="button" class="icon-sort-button"
                                        onclick="@(() => SortTable("DueDate"))">
                                    Due date
                                    <div class="icon-sort"></div>
                                </button>
                            </th>
                            <th scope="col" class="govuk-table__header app-custom-class" width="15%">
                                <button aria-label="Sort by Status" type="button" class="icon-sort-button"
                                        onclick="@(() => SortTable("Status"))">
                                    Status
                                    <div class="icon-sort"></div>
                                </button>
                            </th>
                            <th scope="col" class="govuk-table__header app-custom-class" width="10%"></th>
                            <th scope="col" class="govuk-table__header app-custom-class" width="10%"></th>
                        </tr>
                    </thead>

                    <tbody class="govuk-table__body govuk-body govuk-!-font-size-16" style="width:100%;">
                        @foreach (var reservoir in ReservoirsLinkedToUserForDisplay)
                        {
                            <tr class="govuk-table__row">
                                <td scope="row" class="govuk-table__cell" width="25%">@reservoir.ReservoirName</td>
                                <td class="govuk-table__cell" width="25%">@reservoir.UndertakerName</td>
                                <td class="govuk-table__cell" width="20%">@reservoir.DueDate</td>
                                <td class="govuk-table__cell" width="15%">
                                    @if (reservoir.Status.ToLower() == "in progress")
                                    {
                                        <strong class="in-progress-tag-new">
                                            @reservoir.Status
                                        </strong>
                                    }
                                    else if (reservoir.Status.ToLower() == "sent")
                                    {
                                        <strong class="sent-tag-new">
                                            @reservoir.Status
                                        </strong>
                                    }
                                    else
                                    {
                                        <strong class="not-started-tag-new">
                                            @reservoir.Status
                                        </strong>
                                    }
                                </td>
                                <td class="govuk-table__cell" width="10%" style="text-align:center;">
                                    <a class="govuk-link govuk-link--no-visited-state" style="cursor:pointer;" @onclick="()=>DownloadTemplateFile(reservoir)">Download
                                        <span class="govuk-visually-hidden">template</span></a>
                                </td>
                                @if (reservoir.Status.ToLower() == "in progress")
                                {
                                    <td class="govuk-table__cell" width="10%" style="text-align:right;">
                                        <a class="govuk-link govuk-link--no-visited-state" style="cursor:pointer;" @onclick="()=>gotoSubmissionPage(reservoir)">Send
                                            <span class="govuk-visually-hidden">template</span></a>
                                    </td>
                                }
                                else
                                {
                                    <td class="govuk-table__cell" width="10%" style="text-align:right;">&nbsp;</td>
                                }
                            </tr>
                            <input type="hidden" value="@reservoir.ReservoirID" />
                            <input type="hidden" value="@reservoir.UndertakerEmail" />
                            <input type="hidden" value="@reservoir.SubmissionReference" />
                        }
                    </tbody>
                </table>

            </div>

        </div>

    </main>
</div>
<Footer />