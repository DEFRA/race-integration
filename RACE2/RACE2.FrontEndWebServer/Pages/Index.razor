@page "/"
@using System.Security.Claims;
@using RACE2.FrontEndWebServer.Components;
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager NavigationManager
<FeedbackSurvey/>
<div class="govuk-width-container ">
    <main class="govuk-main-wrapper govuk-main-wrapper--auto-spacing" id="main-content" role="main">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                <p class="govuk-heading-xl">
                    Service name
                </p>
    @*                <h1 class="govuk-heading-xl">
                    Service name
                </h1>*@

                <p class="govuk-body">Use this service to send a supervising engineer's annual statement to the Environment Agency.</p>

                <p class="govuk-body">This service is for statutory annual statements. To send a non-statutory statement email the Environment Agency.</p>

                <p class="govuk-body">Email <a href="mailto:reservoirs@environment-agency.gov.uk" class="govuk-link">reservoirs@environment-agency.gov.uk</a></p>
                <AuthorizeView>
                    <NotAuthorized>
                        <button class="govuk-button govuk-button--start govuk-!-margin-top-2 govuk-!-margin-bottom-8"
                                data-module="govuk-button" @onclick="GoToLoginPage">
                            Start now
                            <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19"
                                    viewBox="0 0 33 40" aria-hidden="true" focusable="false">
                                <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"></path>
                            </svg>
                        </button>
                    </NotAuthorized>
                    <Authorized>
                        <button class="govuk-button govuk-button--start govuk-!-margin-top-2 govuk-!-margin-bottom-8"
                                data-module="govuk-button" @onclick="GoToNextPage">
                            Start now
                            <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19"
                                    viewBox="0 0 33 40" aria-hidden="true" focusable="false">
                                <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"></path>
                            </svg>
                        </button>
                    </Authorized>
                </AuthorizeView>

                <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-padding-top-2">Before you start</h2>

                <p class="govuk-body">You'll need an email address to set up an account.</p>

                <p class="govuk-body">
                    Read about<a href="https://www.gov.uk/guidance/reservoir-supervising-engineers-written-statements-and-site-visit-reports"
                                    class="govuk-link govuk-link--no-visited-state">
                        supervising engineers' written statements
                        and site visit reports
                    </a>
                </p>
                <br />
                <h2 class="govuk-heading-m govuk-!-font-size-27 govuk-!-padding-top-6"> Get help using this service</h2>

                <p class="govuk-body"> You can <a href="#" class="govuk-link govuk-link--no-visited-state"> get help doing things online</a>.</p>

            </div>
        </div>
    </main>
</div>

@code{

    private IEnumerable<Claim>? Claims { get; set; }

    public string UserName { get; set; } = "Unknown";

    protected override async void OnInitialized()
    {
        AuthenticationState authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();

        //if (authState.User.Claims is not null)
        //{
        //    NavigationManager.NavigateTo("/annual-statements", true);
        //}
    }

    private async void GoToLoginPage()
    {
        bool forceLoad = true;
        NavigationManager.NavigateTo("/login", forceLoad);
    }

    private async void GoToNextPage()
    {
        bool forceLoad = false;
        NavigationManager.NavigateTo("/annual-statements", forceLoad);
        //NavigationManager.NavigateTo("/choose-a-reservoir", forceLoad);
        //if (authState.User.Claims == null)
        //{
        //    Claims = authState.User.Claims;

        //    Claim? givenNameClaim = authState.User.FindFirst("name");
        //    if (givenNameClaim is not null)
        //    {
        //        UserName = givenNameClaim.Value;
        //    }
        //    NavigationManager.NavigateTo("/annual-statements", forceLoad);
        //}
        //else
        //{
        //    NavigationManager.NavigateTo("/login", forceLoad);
        //}
    }
}

