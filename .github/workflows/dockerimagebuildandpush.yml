on: [workflow_dispatch]
name: Docker Image Build and Push
permissions:
  id-token: write
  contents: read
jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@main
    - name: Azure Login
      uses: azure/login@v1
      with:
        creds: ${{ secrets.AZURE_CREDENTIALS }}
    - uses: mr-smithers-excellent/docker-build-push@v6
      name: Build & push Docker image
      with:
        workingdirectory: ./RACE2
        image: race2acr.azurecr.io/race2securityprovider
        tags: latest
        registry: race2acr.azurecr.io
        dockerfile: ./RACE2/Dockerfile_SecurityProvider
        username: Race2ACR
        password: 3q23FKncYFoNMky5N+4arugBI6FHagtWC07sVgPHdo+ACRB3HwHE
